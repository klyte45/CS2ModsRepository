!function(e){"object"==typeof module&&module.exports?module.exports=e(global,global.engine,!1):engine=e(this,window.engine,!0)}((function(e,t,n){"use strict";var o=function(){this.events={}},r=function(e,t){this.code=e,this.context=t},i=void 0!==t;if((t=t||{})._Initialized)return t;var a=[2,0,2,0];for(var s in o.prototype._createClear=function(e,n,o,r){return function(){var i=e.events[n];if(i){var a=-1;if(void 0===o){for(var s=0;s<i.length;++s)if(void 0!==i[s].wasInCPP){a=s;break}}else a=i.indexOf(o);-1!=a&&(i.splice(a,1),0===i.length&&delete e.events[n])}else void 0!==t.RemoveOnHandler&&t.RemoveOnHandler(n,o,r||t)}},o.prototype.on=function(e,t,n){var o=this.events[e];void 0===o&&(o=this.events[e]=[]);var i=new r(t,n||this);return o.push(i),{clear:this._createClear(this,e,i,n)}},o.prototype.off=function(e,n,o){var r=this.events[e];if(void 0!==r){var i;o=o||this;var a=r.length;for(i=0;i<a;++i){var s=r[i];if(s.code==n&&s.context==o)break}i<a&&(r.splice(i,1),0===r.length&&delete this.events[e])}else t.RemoveOnHandler(e,n,o||this)},o.prototype.trigger=function(e){var t=this.events[e];if(void 0!==t){var n=Array.prototype.slice.call(arguments,1);return t.forEach((function(e){e.code.apply(e.context,n)})),!0}return!1},t.isAttached=i,t.isAttached||(o.prototype.on=function(e,t,n){var o=this.events[e];this.browserCallbackOn&&this.browserCallbackOn(e,t,n),void 0===o&&(o=this.events[e]=[]);var i=new r(t,n||this);return o.push(i),{clear:this._createClear(this,e,i)}},o.prototype.off=function(e,t,n){var o=this.events[e];if(void 0!==o){var r;n=n||this;var i=o.length;for(r=0;r<i;++r){var a=o[r];if(a.code==t&&a.context==n)break}r<i&&(o.splice(r,1),0===o.length&&(delete this.events[e],this.browserCallbackOff&&this.browserCallbackOff(e,t,n)))}},t.SendMessage=function(e,n){var o=Array.prototype.slice.call(arguments,2),r=t._ActiveRequests[n];delete t._ActiveRequests[n],window.setTimeout((function(){var n=t._mocks[e];void 0!==n&&r.resolve(n.apply(t,o))}),16)},t.TriggerEvent=function(){var e=Array.prototype.slice.call(arguments);return window.setTimeout((function(){var n=t._mocks[e[0]];void 0!==n&&n.apply(t,e.slice(1))}),16),void 0!==t._mocks[e[0]]},t.BindingsReady=function(){t._OnReady()},t.createJSModel=function(t,n){e[t]=n},t.updateWholeModel=function(){},t.synchronizeModels=function(){},t.enableImmediateLayout=function(){},t.isImmediateLayoutEnabled=function(){return!0},t.executeImmediateLayoutSync=function(){},t._mocks={},t._mockImpl=function(e,t,n,o){t&&(this._mocks[e]=t);var r=t.toString().replace("function "+t.name+"(",""),i=r.indexOf(")"),a=r.substr(0,i);this.browserCallbackMock&&this.browserCallbackMock(e,a,n,Boolean(o))},t.mock=function(e,t,n){this._mockImpl(e,t,!0,n)}),t.events={},o.prototype)t[s]=o.prototype[s];return t.isAttached&&(t.on=function(e,n,o){return n?(t.AddOrRemoveOnHandler(e,n,o||t),{clear:this._createClear(this,e,n,o)}):(console.error("No handler specified for engine.on"),{clear:function(){}})}),t.whenReady=new Promise((function(e){t.on("Ready",e)})),t._trigger=o.prototype.trigger,t.trigger=function(){this._trigger.apply(this,arguments)||this.TriggerEvent.apply(this,arguments)},t.isAttached&&(t.mock=function(){}),t._BindingsReady=!1,t._WindowLoaded=!1,t._RequestId=0,t._ActiveRequests={},t.call=function(){t._RequestId++;var e=t._RequestId,n=Array.prototype.slice.call(arguments);n.splice(1,0,e);var o=new Promise((function(o,r){t._ActiveRequests[e]={resolve:o,reject:r},t.SendMessage.apply(t,n)}));return o},t._Result=function(e){var n=t._ActiveRequests[e];if(void 0!==n){delete t._ActiveRequests[e];var o=Array.prototype.slice.call(arguments);o.shift(),n.resolve.apply(n,o)}},t._Reject=function(e){var n=t._ActiveRequests[e];void 0!==n&&(delete t._ActiveRequests[e],requestAnimationFrame((function(){return n.reject("No handler registered")})))},t._ForEachError=function(e,t){for(var n=e.length,o=0;o<n;++o)t(e[o].first,e[o].second)},t._TriggerError=function(e){t.trigger("Error",e)},t._OnError=function(e,n){if(null===e||0===e)t._ForEachError(n,t._TriggerError);else{var o=t._ActiveRequests[e];delete t._ActiveRequests[e],o.reject(new Error(n[0].second))}if(n.length)throw new Error(n[0].second)},t._OnReady=function(){t._BindingsReady=!0,t._WindowLoaded&&t.trigger("Ready")},t._OnWindowLoaded=function(){t._WindowLoaded=!0,t._BindingsReady&&t.trigger("Ready")},n?e.addEventListener("load",(function(){t._OnWindowLoaded()})):t._WindowLoaded=!0,t.on("_Result",t._Result,t),t.on("_Reject",t._Reject,t),t.on("_OnReady",t._OnReady,t),t.on("_OnError",t._OnError,t),t.dependency=new WeakMap,t.hasAttachedUpdateListner=!1,t.onUpdateWholeModel=function(e){(t.dependency.get(e)||[]).forEach((function(e){return t.updateWholeModel(e)}))},t.createObservableModel=function(e){var n={set:function(n,o,r){t.updateWholeModel(window[e]),n[o]=r}};t.createJSModel(e,new Proxy({},n))},t.addSynchronizationDependency=function(e,n){t.hasAttachedUpdateListner||(t.addDataBindEventListner("updateWholeModel",t.onUpdateWholeModel),t.hasAttachedUpdateListner=!0);var o=t.dependency.get(e);o||(o=[],t.dependency.set(e,o)),o.push(n)},t.removeSynchronizationDependency=function(e,n){var o=t.dependency.get(e)||[];o.splice(o.indexOf(n),1)},t.BindingsReady(a[0],a[1],a[2],a[3]),t._Initialized=!0,t}));